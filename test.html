<!doctype html>
<script src=muT.min.js></script>
template<br>
<textarea id=template rows=5 cols=80>
  Hello {nickname}!
  <br>
  It's {= "<b>" + new Date() + "</b>"}
  <br>
  {{ for (index = 0; index < 5; index++) { }}
    { index }
  {{ } }}
</textarea>
<br>
<button id=btnSource>source</button>
<br>
sorgente generato<br>
<textarea id=source rows=5 cols=80></textarea>
<br>
<input id=argNames value=nickname>
&nbsp;
<button id=btnCompile>compile</button>
<br>
<div id=compileMessage></div>
<br>
input (json)<br>
<textarea id=jsonInput rows=5 cols=80>["daniele"]</textarea>
<br>
<button id=btnExecute>execute</button>
<br>
output<br>
<div id=executeMessage></div>
<script>
var gen_source = function() {
	window.tmplSource = document.getElementById('template').value;
	window.fnSource = muT.toSource(tmplSource);
	document.getElementById('source').value = fnSource;
};
var compile_template = function() {
	gen_source();
	window.argNames = document.getElementById('argNames').value.split(",");
	try {
		window.template = muT.template(tmplSource, argNames);
		document.getElementById('compileMessage').innerHTML = 'OK';
	} catch (e) {
		document.getElementById('compileMessage').innerHTML = 'KO ' + e.message;
	}
};
var execute = function() {
	compile_template();
	try {
		window.input = JSON.parse(document.getElementById('jsonInput').value);
		window.output = template.apply(null, input);
		document.getElementById('executeMessage').innerHTML = window.output;
	} catch (e) {
		document.getElementById('executeMessage').innerHTML = 'KO ' + e.message;
	}
};

document.addEventListener('click', function(event) {
	if (event.target.id === 'btnSource') {
		gen_source();
	} else if (event.target.id === 'btnCompile') {
		compile_template();
	} else if (event.target.id === 'btnExecute') {
		execute();
	}
}, false);
</script>
